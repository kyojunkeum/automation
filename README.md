# automation

## 1. 프로젝트 개요 (Overview)

이 프로젝트는 DLP 보안솔루션의 로깅 기능을 검증하는 역할을 합니다. 

## 2. 왜 이 프로젝트가 필요한가? (Problem)

DLP 가 감시하는 서비스들은 각 개별 업데이트가 발생하고, 그에 따라 URL 패턴, 통신 프로토콜 변경 등의 사유로 
로깅 기능이 무력화되는 경우가 있습니다. 
이를 선제적으로 파악하지 못하면 고객사로부터 로깅 불가 이슈를 받게 되고, 이는 고객사 신뢰도의 저하로 이어집니다. 

## 3. 해결 방법 (Solution)

각 서비스별 서비스 활동 -> ES 조회를 통해 로깅 기능이 정상적으로 수행되었는지 판단하여 
서비스의 패턴 및 프로토콜 등이 변경되었는지 선제적으로 파악하여 개발팀에 전달합니다.

## 4. 주요 기능 (Features)

1. 각 서비스, 프로토콜별로 기본 본문, 개인정보 포함 내용, 키워드 포함 내용, 파일 첨부 활동을 수행하고
ElasticSearch 에 정상적으로 로깅되었는지 로그 조회 및 결과값 비교를 통해 해당 서비스의 로깅이 정상적으로 수행되었는지 판단합니다. 
지원하는 서비스 종류는 메일, 메신저(일부), SNS, 댓글, 업무공유(노션, 두레이 업무 등), 웹하드 등이 있습니다.  

2. 공통(common) 시험항목으로 API 테스트, HTTP 부하 테스트, 
코어 재기동 후 네트워크 통신 연결 테스트, 장비 재부팅 후 네트워크 통신 연결 테스트도 포함되어 있습니다.

3. playwright 와 pytest, allure 를 활용하여 generate_and_upload_report_V2를 실행하면 
test_ 로 시작하는 테스트 케이스별 코드들이 서비스 활동 -> ES 검증을 수행합니다. 
한 바퀴가 끝나면 특정 http 서버로 테스트 결과(allure_result) 를 전송하게 됩니다. 
마지막으로 테스트 결과를 http 서버에 접속하여 확인가능합니다. 

4. 검증이 실패한 테스트 케이스는 각각 스크린샷과 에러 로그를 확인해볼 수 있습니다. 
이를 통해 패턴이나 프로토콜이 변경된 것인지, 테스트 환경 때문에 발생한 것인지 미리 파악이 가능합니다. 

## 5. 시스템 구조 / 흐름 (Architecture)

generate--.py 실행 -> 각 test_케이스 실행 -> ES 검증(test_케이스 내부) -> WEB SERVER로 결과 전송 -> WEB 사이트 접속 후 결과 확인

## 6. 사용 기술 (Tech Stack)

 - Language : Python 
 - Framework : Playwright
 - Tools : allure-report, pytest...
 
## 7. 실행 방법 (How To Run)

로컬에서 pycharm 등의 IDE 프로그램에서 해당 프로젝트를 열고 generate_and_upload_report_V2를 실행합니다. 
* 단, 테스트 결과를 수집하여 보여줄 수 있는 http서버가 존재해야 합니다. 

## 8. 한계와 개선 방향 (Limitations & Future Work)

아직 약 21가지의 서비스만 완전 구현된 상태입니다. 당사 DLP 가 로깅을 지원하는 서비스는 약 120개로 
자동화 대상 서비스의 확장이 필요합니다. 

## 9. 이 프로젝트를 통해 얻은 것

1. 각 서비스별로 파일첨부 하는 요소가 다 다릅니다. 본문은 거의 비슷하여 구현이 쉽지만, 파일첨부는 요소가 iframe등에 숨겨져있거나, 
자주 바뀌기도 합니다. 때문에 이 요소들을 다양하게 잡아 구현하는 것이 주요했습니다.
2. playwright 도 만능이 아니기에 '정확도'를 중시할지 '속도'를 중시할지 목표가 명확해야 그점을 해결하기가 쉽습니다. 
해당 프로젝트는 변경된 서비스의 프로토콜 등을 선제탐지 하는 것이 목적이기에 속도보다 '정확도'를 중시하였고, 
브라우저가 로딩되는 시간을 충분히 기다릴 수 있도록 코드를 구성하였습니다. 
3. 아무래도 캡챠 같은 매크로 방지 프로그램을 극복하기가 쉽지 않습니다. 하여 해당 프로젝트에서는 매크로 방지 프로그램으로 막히는 서비스는
스킵하고 가능한 서비스들만 선제적으로 구현하고 있습니다. 향후에 이러한 부분들은 방법을 찾아 해결해야 할 개선점입니다.
